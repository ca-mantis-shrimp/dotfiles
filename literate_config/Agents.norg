@document.meta
title: Agents Direction
description: Hand-written guidance for LLM agents working on the literate config
authors: primary_desktop
categories: LLM
created: 2025-08-23T10:42:54-0800
updated: 2025-08-23T11:13:12-0800
version: 1.1.1
@end
Hello my robotic colleague, please consider this both your first source of direction, as well as your personal space to write notes and guidance for future robotic colleagues to know what they should know going forward.

If all goes well, even if you cant solve a problem, you can help the next LLM that is given the action you were given

The sections will go over topics that include:
- what tools to use
- how to properly build the workflow
- how I expect you to interact with the code base

* Quick Start - Your First 5 Minutes
  Before diving into the philosophy, here's how to get oriented and make your first safe change:

** Step 1: Understand the Current State
   @code bash
   # Check what chezmoi knows about
   chezmoi status
   
   # See the literate config structure
   find literate_config -name "*.norg" | head -10
   
   # Check for any pending changes
   git status
   @end

** Step 2: Practice the Workflow (Safe Example)
   Let's practice on a simple file that won't break anything. We'll add a comment to the git config:

   @code bash
   # 1. Open the git norg file
   nvim literate_config/git.norg
   
   # 2. In neovim, find a safe place to add a comment
   # 3. Add something like: # Added by agent on [date]
   # 4. Save the file (:w)
   # 5. Tangle it: :Neorg tangle current-file
   # 6. Check what was generated: ls -la literate_config/
   @end

** Step 3: Understand File Relationships
   Key patterns to recognize:
   - `.norg` files are the source of truth (edit these)
   - `.fnl` files are generated from norg (don't edit directly)
   - `.lua` files are compiled from fennel (don't edit directly)
   - Symlinks in the main repo point to generated files
   - `chezmoi apply` copies from repo to actual system locations

** Step 4: Common Commands Reference
   @code bash
   # In neovim with a .norg file open:
   :Neorg tangle current-file    # Generate the target file
   :Neorg export to-file <path>  # Export to markdown (for docs)
   
   # For fennel files (neovim config):
   # 1. Tangle the .norg to create .fnl
   # 2. Open the .fnl file and save it (:w) to trigger lua generation
   # 3. Open the .lua file and save it (:w) to trigger stylua formatting
   
   # Testing and applying:
   chezmoi apply --dry-run       # See what would change
   chezmoi apply                 # Actually apply changes
   chezmoi apply --force         # Force apply (use carefully)
   @end

** Step 5: Before You Break Things Checklist
   - [ ] Is there already a .norg file for what I want to change?
   - [ ] Did I read the existing norg file to understand current decisions?
   - [ ] Am I editing the .norg file (not the generated file)?
   - [ ] Did I test with `chezmoi apply --dry-run` first?
   - [ ] Do I understand which other tools might be affected?

** Architecture Mental Model
   @code
   .norg files → tangle → .fnl/.conf files → compile/symlink → chezmoi → applied config
        ↑                                                                      ↓
        └─────────────── feedback loop (test, iterate) ←──────────────────────┘
   @end

** When Things Go Wrong
   Common issues and solutions:
   - *Tangle command not found*: Make sure you're in a .norg buffer in neovim
   - *Generated file looks wrong*: Check the #tangle directive in the .norg file
   - *Symlink broken*: Use `find . -type l -exec test ! -e {} \; -print` to find broken links
   - *chezmoi apply fails*: Check `chezmoi doctor` and `chezmoi status`
   - *Fennel won't compile*: Check syntax, ensure nfnl is working with `:checkhealth`

* Context
  What you need to know is that this is my private configuration for my home directory in any computer i might interact with including but not limited to:
  - traditional x86 computers
  -- both linux
  -- and windows
  - ARM devices like phones
  - containers and virtual machines

  Our hope is that we can have "one configuration to rule them all" which will be employable in any environment and I can immediately have all my tools ready.

  This is also the site for a second, very special experiment involving you. See, I think that given the proper guidance, you can accomplish more than most would think, so the entire configuration (to the best im able) is REALLY located in the `literate_config` directory where each `*.norg` file contains not just the code for the file in question, but also a written explanation of how things work, why certain decisions were made, and even how to test and look for the changes we are making

  all of this is enabled through a combination of `chezmoi` for home directory management, and `neorg` for literate config capabilities. You can read more about how we employ both in the literate config!

  even this very document is exported from the literate_config folder so be sure to check it out to see the core source

* Goals
  We want to create a space where we can configure all of our tools once and apply them everywhere, no more trying to tinker with the machine to get everything working at once.

  This allows us to try new cool things with the config while putting it all together in a coherent way that makes composing different tools easy and fun!

* Workflow
  To this end, you will work almost entirely from within the literate config folder. You will research the decisions made up until that point, along with any supporting files you may need to pull BEFORE making changes by understanding that this is a shared space and that many tools are interacting together so it is of utmost importance that the implications of a decision are thought out BEFORE we make any changes to the code.

  In fact, I would ask that you air on the side of humility and ask any questions where you have any, again, BEFORE making updates to the repository so that changes that break the config are not put in haphazardly

  more than that, you should also update the config file themselves WHENEVER YOU UPDATE A CODE SNIPPET to include the reasoning behind your decision and any extra notes that future users may want to know.

  This is intended to be a garden where knowledge can grow, and this can only happen when we go out of our way to make ourselves understandable

  in fact, it is even acceptable to put questions in the literate config so you can be clear about where you are not sure or where you dont know what a line is doing, this will help the next person/bot to understand where we have definitive knowledge and where we are just following a tutorial

  so, the worklow goes like this:
  ~ you are given an action
  ~ you review the relevant `norg` files and any supporting information
  ~ you make a plan and ask questions to me about any ambiguity, making updates or changes to the norg files to alleviate confusion
  ~ then once you are ready you update the norg files to represent the new state you want
  ~ you will then tangle the norg file into an equivalent file in the same directory
  ~ if there is not a symlink already to the file in the rest of the repo, you also need to make it to ensure its picked up by the config
  ~ once you are sure the update is visible to chezmoi you can use `chezmoi apply` to actually apply the changes to the source state

* Deployment
  Because of our very unique architecture we must be disciplined in how we handle the various steps:
  ~ `norg` files are considered the source of truth and all prose and code edits should go into them exclusively
  ~ then, we use the neovim command `:Neorg tangle current-file` while editing the norg buffer to actually "tangle" it to the desired file
  ~ For some tools (like neovim) where we actually generate fennel files which still need to be converted to lua, you need to actually open the file you generated and save it so that the new new lua file is generated 
  ~ then you open that new lua file and save it so that it can be formatted by `stylua`
  ~ that lua file is what will be actually used as the symlink in the chezmoi folders

** Concrete Deployment Example
   Here's the exact sequence for a neovim plugin change:
   @code bash
   # 1. Edit the norg file
   nvim literate_config/neovim/plugins/navigation.norg
   
   # 2. In neovim, make your changes, then:
   :w                           # Save the norg file
   :Neorg tangle current-file   # Generate the .fnl file
   
   # 3. Open the generated fennel file
   :e navigation.fnl            # Open in same neovim session
   :w                           # Save to trigger nfnl compilation to .lua
   
   # 4. Open the lua file to format it
   :e navigation.lua            # Open the generated lua file
   :w                           # Save to trigger stylua formatting
   
   # 5. Ensure symlink exists (if this is a new file)
   # Check: ls -la ../../dot_config/remove_nvim/lua/remove_plugins/
   # Create if needed: ln -s ../../../literate_config/neovim/plugins/navigation.lua ../../dot_config/remove_nvim/lua/remove_plugins/navigation.lua
   
   # 6. Apply the changes
   chezmoi apply --dry-run      # Check what will change
   chezmoi apply                # Actually apply
   @end

  Again, chezmoi is the underlying system of this so be sure to familiarize yourself with how chezmoi handles the source state. In particular, you will notice that you get allot of information about the layout of the files just from looking at the layout of the repository since all chezmoi really does is clone the state of the repository to the target machine. Therefore, you can get allot of context about where i file should go/be just by looking at the hierarchy.

  This will also be important when you are deploying so you know WHERE to symlink the file from and even where to put it because features like prefixes can be tricky at first

  Once the symlink is created, you use the `chezmoi` cli to actually APPLY the changes. 
  your bread-and-butter will be `chezmoi apply` with the `--force` flag if you are very confident the changes wont overwrite anything important 

  This is also a git repo remember, so periodically `git push origin` and `git fetch` to make sure you have the latest versions. This is a personal config so you shouldnt be fighting with other people it would likely be config coming from other machines

for documentation like this, you will use the neovim command `Neorg export to-file ...` command to generate a markdown file which is subtly different than tangling

* Testing
  While this is still experimental, I would like for you to simply be able to use the `mkosi` command to:
  - create a vm according to the `mkosi.conf` file that contains the newest config
  - from there, you will have a good playground to test whatever you need to make sure any changes got applied gracefully
  - this also allows you to test changes BEFORE `chezmoi apply` ing them so work towards making that workflow seamless is worth its weight in gold

  and ofcourse, that `mkosi` config should go into the literate config if it doesnt exist already

  but either way you can also hand it off to me to test since much of this will be something I need to test with my eyes and fingers, so it is again disciplined to ask me to do something rather than trying to make a programmatic test first.

if you do make steps to test something in the literate config again that helps me remember and trust your work even if its not something i can run but something to run would be nice where possible or even again what i should be seeing if the configuration change is visual

* Agent Notes and Learnings
  This section is for future agents to leave notes about what they learned, common pitfalls, and improvements to the workflow.

** File Discovery Patterns
   When looking for existing config:
   @code bash
   # Find which norg file controls a specific tool
   grep -r "tool_name" literate_config/
   
   # Find all tangle directives to see what files are generated
   grep -r "#tangle" literate_config/
   
   # Check for broken symlinks
   find . -type l -exec test ! -e {} \; -print
   
   # See what chezmoi would do without doing it
   chezmoi apply --dry-run --verbose
   @end

** Common Gotchas Discovered
   - The `:` is crucial in `:Neorg tangle current-file` - it's a neovim command, not a shell command
   - Fennel files need to be opened and saved in neovim to trigger nfnl compilation
   - Generated lua files need to be saved again to trigger stylua formatting
   - Always check if symlinks exist before creating new ones
   - The `.nvim.lua` file in literate_config sets `makeprg = "chezmoi apply"` so you can use `:make` in neovim
   - Some norg files generate multiple output files - check the #tangle directives carefully

** Workflow Improvements Identified
   - Could create a neovim command to automate the tangle→compile→format pipeline
   - Could add git hooks to ensure norg files are always committed as source of truth
   - Could create a validation script to check for missing symlinks or broken tangle directives
   - The mkosi.conf could be expanded to include chezmoi setup for better testing

** Questions for Future Investigation
   - How does the nfnl compilation exactly work? Is it triggered by file save or something else?
   - Are there any tools that depend on specific formatting of the generated files?
   - What's the best way to handle platform-specific config within the norg files?
   - Should we create automation scripts for the common workflows?

** Tangle Directive Patterns Reference

Two main patterns for tangle directives discovered in the codebase:

*** Simple Tangle (Most Common - 90% of files)
@code norg
#tangle filename.ext
@code language
content here
@end
@end

Examples: navigation.norg → navigation.fnl, kitty_config.norg → kitty.conf

*** Complex Tangle (Multiple Outputs)
@code norg
tangle: {
    key1: path/to/file1
    key2: path/to/file2
}
#tangle key1
@code language
content for file1
@end
#tangle key2  
@code language
content for file2
@end
@end

Example: git.norg generates both .gitignore and dot_gitconfig.tmpl

** File Type Workflow Matrix

Based on analysis of 33+ norg files with tangle directives:

| Source Type | Steps | Commands | Example |
|-------------|-------|----------|---------|
| Config files (.conf, .toml, etc.) | 1 | `:Neorg tangle current-file` | kitty.conf, hyprland.conf |
| Neovim plugins (.fnl → .lua) | 3 | `:Neorg tangle current-file` → open .fnl → `:w` → open .lua → `:w` | navigation.norg → navigation.fnl → navigation.lua |
| Shell scripts | 1 | `:Neorg tangle current-file` | nvim_paste_wsl.norg → .sh |
| Templates (.tmpl) | 1 | `:Neorg tangle current-file` | Profile.ps1.tmpl, config.fish.tmpl |

** Symlink Verification Commands

Current state: 17 neovim plugin files properly symlinked

@code bash
# Check if symlinks exist for neovim plugins
ls -la dot_config/remove_nvim/lua/remove_plugins/

# Find all symlinks in repo
find . -type l -ls

# Verify symlink targets exist (should return nothing if all good)
find . -type l -exec test ! -e {} \; -print

# Count symlinked files
ls -la dot_config/remove_nvim/lua/remove_plugins/ | wc -l
@end

** mkosi Testing Status

Current mkosi.conf is minimal but functional:
- Base Arch Linux with essential packages (base, linux, linux-firmware)
- Includes git, neovim, chezmoi for basic testing
- Creates /bin/bash symlink for compatibility
- Ready for expansion with more comprehensive testing setup

To use: `mkosi build` creates a test environment in ./mkosi.output/

** Platform-Specific Patterns

Template files use chezmoi conditionals for cross-platform support:

@code
{{- if eq .chezmoi.hostname "USMINDARBURGES1" }}
work-specific config
{{ else }}
personal config
{{- end }}
@end

Current platforms detected:
- USMINDARBURGES1 (work machine)
- Default (personal machines)

Template files found: 5 (.tmpl files for PowerShell, Fish, Aerc, etc.)

** Repository Health Check Commands

@code bash
# Check chezmoi health
chezmoi doctor

# See what would change without applying
chezmoi apply --dry-run

# Check git status
git status

# Verify all tangle directives
grep -r "#tangle" literate_config/ | wc -l  # Should be 33+

# Check for missing symlinks in neovim plugins
ls -la dot_config/remove_nvim/lua/remove_plugins/ | grep -v "^total"
@end

** Agent Learning Log

*** 2025-08-23 - Initial Documentation Agent
- Explored 33+ norg files with tangle directives
- Confirmed symlink structure (17 neovim plugins properly linked)
- Verified chezmoi health (working tree dirty but functional)
- Identified two tangle patterns: simple (#tangle file) and complex (tangle: {key: path})
- Documented file type workflows: 1-step for configs, 3-step for fennel→lua
- Found platform-specific template patterns using chezmoi conditionals
- mkosi.conf exists but minimal - ready for expansion
