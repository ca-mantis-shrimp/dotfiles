@document.meta
title: testing
description: 
authors: primary_desktop
categories: 
created: 2025-08-31T22:41:32-0800
updated: 2025-08-31T22:41:36-0800
version: 1.1.1
@end
* Remote Access for Weak Nodes
For connecting from devices without systemd (phones, tablets) or remote machines, we use SSH socket forwarding:

** From Remote Machine (Weak Node)
@code bash
# Create SSH tunnel with socket forwarding
ssh -L /tmp/nvim-remote.sock:/home/primary_desktop/.cache/nvim/server.pipe user@strong-edge-machine

# In another terminal on the remote machine, connect to neovim
nvim --server /tmp/nvim-remote.sock --remote-ui

# Or use neovide if available
neovide --server /tmp/nvim-remote.sock
@end

** Security Considerations
- Unix socket permissions (0600) ensure only the owner can connect locally
- SSH provides encryption and authentication for remote connections
- No direct network exposure of the neovim server
- Follows principle of secure-by-default configuration

** Testing the Setup
 
Local connection test:
@code bash
# Check if socket is listening
systemctl --user status neovim-server.socket
 
# Connect with TUI client (triggers socket activation)
# Important: the service does NOT bind the socket; systemd passes the connection via stdio
nvim --server ~/.cache/nvim/server.pipe --remote-ui
 
# Check if service started
systemctl --user status neovimServer.service
@end

Remote connection test:
@code bash
# From remote machine
ssh -L /tmp/test.sock:/home/user/.cache/nvim/server.pipe user@server
nvim --server /tmp/test.sock --remote-send ':echo "Remote connection works!"<CR>'
@end

** Troubleshooting
 
Common issues:
- *Socket file not found*: Check `systemctl --user status neovim-server.socket`
- *Permission denied*: Verify socket file permissions and ownership
- *Service won't start*: Check `journalctl --user -u neovimServer.service`
- *Remote connection fails*: Verify SSH tunnel and socket path
- *Socket is taken / address in use*: Ensure `ExecStart` uses `--embed` (not `--listen`); stop both units and remove stale path
  @code bash
  systemctl --user stop neovimServer.service neovim-server.socket
  rm -f ~/.cache/nvim/server.pipe
  systemctl --user start neovim-server.socket
  @end

** Migration from Always-On Service

To migrate from the previous always-on service:
@code bash
# Stop and disable old service
systemctl --user stop neovimServer.service
systemctl --user disable neovimServer.service

# Enable and start socket unit
systemctl --user enable neovim-server.socket
systemctl --user start neovim-server.socket

# Update client services
systemctl --user daemon-reload
systemctl --user restart neovideWindow.service
@end
